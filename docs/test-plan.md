# 家庭物品管家系统测试计划

> 版本：v1.0  
> 对应需求：`docs/requirements.md`  
> 目标读者：测试工程师、开发、产品、运维

---

## 1. 测试目标
- 确保系统功能与 `requirements.md` 中的 P0~P3 功能需求一致。
- 验证核心业务流程（物品管理、采购/使用、库存提醒等）可靠、稳定。
- 保障性能、兼容性、安全性满足上线要求。
- 发现并反馈缺陷，保障上线质量。

---

## 2. 测试范围与优先级
| 范围 | 模块/功能 | 优先级 |
| --- | --- | --- |
| P0 核心流程 | 用户注册/登录、分类/位置、物品、库存、采购记录、使用记录 | 高 |
| P1 强化功能 | 提醒、仪表盘、购物清单、操作日志 | 中 |
| P2 高级功能 | 图片上传、导入导出、预算管理、标签、盘点、统计 | 中 |
| P3 优化功能 | MQ 异步任务、WebSocket 实时通知、多租户（预留）、创意功能 | 中/低 |

> UI/前端测试不在本计划范围内，若有前端项目，请另行制定。

---

## 3. 测试策略与类型
| 类型 | 说明 | 工具/方法 |
| --- | --- | --- |
| 单元测试 | Service、Guard、Pipe 等单元模块 | Jest |
| 集成测试 | 多模块交互，事务逻辑 | Jest + In-memory DB / Test DB |
| E2E 测试 | REST API 端到端流程（使用 supertest） | `test/*.e2e-spec.ts` |
| 功能测试 | 手工执行用例，覆盖需求清单 | 测试用例文档 + Postman |
| 回归测试 | 每个迭代后的核心功能回测 | 自动化 + 手工 |
| 性能测试 | 压测关键接口（采购确认、提醒生成） | JMeter / k6 |
| 安全测试 | 权限绕过、输入校验、弱口令、JWT 篡改 | 手工/工具 |
| 灰度测试 | 预生产环境演练 | 同 prod 规格 |

---

## 4. 环境规划
| 环境 | 说明 | 目的 |
| --- | --- | --- |
| 开发环境 | 本地 + Docker | 开发自测 |
| 测试环境（QA） | 独立服务器 / Docker Compose | 测试执行、集成验证 |
| 预生产环境 | 与线上一致 | 灰度、性能、安全验证 |
| 生产环境 | 上线 | 实际运行 |

### 环境配置要点
- PostgreSQL、Redis、RabbitMQ 与应用版本保持一致
- 使用配置管理加载 `.env`，区分 dev/test/prod
- 测试环境数据定期刷新（或构造种子数据）

---

## 5. 测试工具 & 资源
- 测试工具：Postman、Swagger UI、JMeter、k6、OWASP ZAP（安全）
- 代码覆盖率：Jest（`npm run test:cov`）
- 缺陷管理：Jira / Trello / GitHub Issues（项目协商）
- 日志查看：Winston 输出、集中日志平台（ELK/Grafana Loki）

---

## 6. 测试用例结构
建议按模块维护测试用例，包含以下内容：
- **用例编号**（如 `ITEM-001`）
- **测试标题**（如“创建物品-正常流程”）
- **测试类型**（功能/异常/性能…）
- **前置条件**
- **测试步骤**
- **预期结果**
- **实际结果**
- **备注/缺陷链接**

> 推荐使用 Excel/Google Sheet 或测试管理工具维护用例列表。

---

## 7. 关键测试场景（示例）
### 7.1 功能测试
1. **用户注册登录**
   - 注册成功、重复注册、密码校验
   - 登录成功、密码错误、账号禁用
2. **物品管理**
   - 创建物品、字段校验、去重提示
   - 更新/删除物品、防止删除有库存的物品
3. **采购流程**
   - 创建草稿 → 确认（库存增加）→ 取消
   - 状态非法操作（如已确认再次确认）
   - 事务一致性：失败时回滚
4. **使用流程**
   - 创建草稿 → 确认（库存减）→ 取消
   - 库存不足时提示
5. **库存查询**
   - 按分类/位置筛选
   - 低库存列表
   - 手动调整记录
6. **提醒功能**
   - 快过期提醒（模拟数据）
   - 快用完提醒
   - 将提醒标记为已读
7. **购物清单**
   - 自动生成清单
   - 手动创建、标记完成
   - 删除后关联状态
8. **统计与仪表盘**
   - 正常返回数据
   - 统计数据与明细数据一致性
9. **附件/导入导出**
   - 上传图片限制（类型/大小）
   - Excel 导入错误处理（格式错误、字段缺失）
   - 导出文件内容校验
10. **操作日志**
    - 关键操作是否记录
    - 日志查询是否可过滤

### 7.2 异步 & 定时任务
- 过期提醒定时任务执行结果（模拟触发）
- MQ 消息堆积处理（模拟异常）
- Excel 导入后台任务成功/失败场景

### 7.3 性能测试
- 采购确认接口在 50 QPS 下响应时间
- 仪表盘接口在 30 QPS 下响应时间
- MQ 消费速度、队列长度监控

### 7.4 安全测试
- JWT 篡改/过期
- 跨角色访问限制
- SQL 注入、XSS 基本校验
- 文件上传限制绕过尝试

---

## 8. 测试进度与安排（参考）
| 时间 | 测试内容 | 说明 |
| --- | --- | --- |
| M1（第2-4周） | 核心模块单元测试 + 功能冒烟测试 | 覆盖 P0 功能 |
| M2（第5-7周） | 功能测试、集成测试 | P1 功能、提醒逻辑 |
| M3（第8-10周） | 高级功能回归测试 | P2 功能、导入导出、预算 |
| M4（第11-12周） | 性能与安全测试 | MQ、实时通知、定时任务 |
| M5（第13周） | 全量回归 + 验收测试 | ≥80% 覆盖率、性能指标 |
| M6（第14周） | 上线前 Check list | 灰度、备份、回滚演练 |

---

## 9. 缺陷管理流程
1. 测试发现问题 → 在缺陷管理工具创建 Issue：描述、复现步骤、截图/日志
2. 设定严重级别（Blocker/High/Medium/Low）
3. 分配给开发修复 → 开发修复提交 MR 并自测
4. 测试验证 → 合格则关闭，失败则重开
5. 每次迭代结束前清零 Blocker/High 缺陷

---

## 10. 验收准则
- 功能：需求清单项全部测试通过
- 缺陷：无 Blocker/High 严重缺陷，Medium 缺陷已评估可延期
- 测试覆盖率：单元 + E2E ≥ 80%
- 性能：符合项目性能指标
- 文档：测试报告、用例、缺陷记录完备

---

## 11. 风险与对策
| 风险 | 影响 | 对策 |
| --- | --- | --- |
| 需求变更频繁 | 测试用例需频繁更新 | 需求冻结/版本管理，敏捷沟通 |
| 测试环境不稳定 | 测试无法顺利执行 | 提前准备环境、环境监控、隔离测试数据 |
| 自动化覆盖不足 | 回归成本高 | 逐步补充自动化用例，明确优先等级 |
| 时间紧迫 | 覆盖不足 | 优先保证核心流程，计划缓冲时间 |

---

## 12. 输出成果
- 测试用例文档（Excel/测试工具）
- 自动化测试脚本（单元/E2E/性能）
- 测试报告（每阶段总结）
- 缺陷记录与处理日志

---

> 如需求或范围调整，请同步更新测试计划并通知相关人员。
